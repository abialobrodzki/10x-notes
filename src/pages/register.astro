---
import Layout from "@/layouts/Layout.astro";
import RegisterPage from "@/components/RegisterPage";

// Disable prerendering - middleware uses request.headers for auth
export const prerender = false;

// Server-side auth check - redirect authenticated users before HTML is sent
// This prevents showing register page after browser back button
const {
  data: { user },
} = await Astro.locals.supabase.auth.getUser();
if (user && user.email) {
  return Astro.redirect("/");
}

// Prevent caching of auth pages to avoid showing them via browser back button
Astro.response.headers.set("Cache-Control", "no-store, must-revalidate, no-cache, private");
Astro.response.headers.set("Pragma", "no-cache");
---

<Layout title="Rejestracja - 10xNotes">
  <RegisterPage client:load />
</Layout>
